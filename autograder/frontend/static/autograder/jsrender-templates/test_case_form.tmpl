<form role='form' class='test_case_form' {{if ~populate_fields}}patch_url="{{:links.self}}"{{/if}}>
    {{if ~populate_fields}}<input type='hidden' name='test_type' value='{{:type}}'>{{/if}}
    <div class='form-group'>
        <label for="name">Name: </label>
        <input name='name' type="text" class="form-control" value='{{if ~populate_fields}}{{: attributes.name}}{{/if}}'>
    </div>

    <div class='checkbox'>
        <label>
            <input type='checkbox' name='hide_from_students'
                   {{if ~populate_fields && attributes.hide_from_students || !~populate_fields}}
                    checked{{/if}}>
            <b>Hide this test from students</b>
        </label>
    </div>

    <div class='form-group'>
        <label for='command_line_arguments'>Command line arguments to be passed to the program:</label>
        <input type='text' name='command_line_arguments' class="form-control"
               value='{{if ~populate_fields}}{{for attributes.command_line_arguments}}{{:}} {{/for}}{{/if}}'>
    </div>

    <div class='form-group'>
        <label for='standard_input'>Standard input to be sent to the program (whitespace is preserved):</label>
        <textarea name='standard_input' class='form-control'>{{if ~populate_fields}}{{:attributes.standard_input}}{{/if}}</textarea>
    </div>

    <label>Project files needed for this test:</label>
        {{for ~root.project.data.attributes.project_files ~test_data=#data}}
        <div class='checkbox'>
            <label>
                <input type='checkbox' value='{{: filename}}' name='test_resource_files'
                        {{if ~populate_fields}}
                            {{if ~in_array(filename, ~test_data.attributes.test_resource_files) }}checked{{/if}}
                        {{/if}}>
                {{> filename}}
            </label>
        </div>
        {{else}}
            <br><i>(No project files found)</i>
        {{/for}}

    <div class='form-group'>
        <label>Student files needed for this test:</label>
        {{for ~root.project.data.attributes.required_student_files ~test_data=#data}}
        <div class='checkbox'>
            <label>
                <input type='checkbox' value='{{:}}' name='student_resource_files'
                        {{if ~populate_fields}}
                            {{if ~in_array(#data, ~test_data.attributes.student_resource_files) }}checked{{/if}}
                        {{/if}}>
                {{>}}
            </label>
        </div>
        {{/for}}
        {{for ~root.project.data.attributes.expected_student_file_patterns ~test_data=#data}}
        <div class='checkbox'>
            <label>
                <input type='checkbox' value='{{:#data[0]}}' name='student_resource_files'
                    {{if ~populate_fields}}
                            {{if ~in_array(#data[0], ~attributes.student_resource_files) }}checked{{/if}}
                    {{/if}}>
                {{> #data[0]}}
            </label>
        </div>
        {{/for}}
    </div>

    <div class='form-group'>
        <label for='compiler'>Compiler:</label>
        <select id='compiler' class='form-control' name='compiler'>
            <option value='g++'>g++</option>
        </select>
    </div>
    <div class='form-group'>
        <label for='compiler_flags'>Compiler flags: </label>
        <input type='text' name='compiler_flags' class='form-control'
               value='{{if ~populate_fields}}{{for attributes.compiler_flags}}{{:}} {{/for}}{{/if}}'>
    </div>
    <div class='form-group'>
        <label>Files to compile together (files checked here must also be checked for Project files or Student files above): </label>
        <div><i>Project files: </i></div>
        {{for ~root.project.data.attributes.project_files ~test_data=#data}}
        <div class='checkbox'>
            <label>
                <input type='checkbox' value='{{:filename}}' name='files_to_compile_together'
                    {{if ~populate_fields}}
                            {{if ~in_array(filename, ~test_data.attributes.files_to_compile_together) &&
                                 ~in_array(filename, ~test_data.attributes.test_resource_files) }}checked{{/if}}
                    {{/if}}>
                {{> #data.filename}}
            </label>
        </div>
        {{/for}}
        <div><i>Student files: </i></div>
        {{for ~root.project.data.attributes.required_student_files ~test_data=#data}}
        <div class='checkbox'>
            <label>
                <input type='checkbox' value='{{:#data}}' name='files_to_compile_together'
                    {{if ~populate_fields}}
                            {{if ~in_array(#data, ~test_data.attributes.files_to_compile_together) &&
                                 ~in_array(#data, ~test_data.attributes.student_resource_files) }}checked{{/if}}
                    {{/if}}>
                {{> #data}}
            </label>
        </div>
        {{/for}}
        {{for ~root.project.data.attributes.expected_student_file_patterns ~test_data=#data}}
        <div class='checkbox'>
            <label>
                <input type='checkbox' value='{{:#data[0]}}' name='files_to_compile_together'
                    {{if ~populate_fields}}
                            {{if ~in_array(#data[0], ~test_data.attributes.files_to_compile_together) }}checked{{/if}}
                    {{/if}}>
                {{> #data[0]}}
            </label>
        </div>
        {{/for}}
    </div>
    <div class='form-group'>
        <label for="executable_name">Executable program name: </label>
        <input name='executable_name' type="text" class="form-control" value='{{if ~populate_fields}}{{: attributes.executable_name}}{{/if}}'>
    </div>

    <div class='form-group'>
        <label for='time_limit'>Time limit (seconds): </label>
        <input type='text' name='time_limit'
               value="{{if ~populate_fields}}{{:attributes.time_limit}}{{else}}5{{/if}}" class='form-control'>
    </div>
    <div class='form-group'>
        <label for='expected_return_code'>Expected program return code: </label>
        <input type='text' name='expected_return_code' value='{{if ~populate_fields}}{{: attributes.expected_return_code}}{{/if}}' class='form-control'>
    </div>
    <div class='checkbox'>
        <label>
            <input type='checkbox' name='expect_any_nonzero_return_code'>
            <b>Expect any nonzero return code</b>
        </label>
    </div>
    <div class='form-group'>
        <label for='expected_standard_output'>Expected program standard output (whitespace is preserved): </label>
        <textarea name='expected_standard_output' class='form-control'>{{if ~populate_fields}}{{: attributes.expected_standard_output}}{{/if}}</textarea>
    </div>
    <div class='form-group'>
        <label for='expected_standard_error_output'>Expected program standard error output (whitespace is preserved): </label>
        <textarea name='expected_standard_error_output' class='form-control'>{{if ~populate_fields}}{{: attributes.expected_standard_error_output}}{{/if}}</textarea>
    </div>
    <div class='checkbox'>
        <label>
            <input type='checkbox' name='use_valgrind' {{if ~populate_fields && attributes.use_valgrind}}checked{{/if}}>
            <b>Use Valgrind</b>
        </label>
    </div>
    <div class='form-group'>
        <label for='valgrind_flags'>Valgrind flags: </label>
        <input type='text' name='valgrind_flags' class='form-control'
               value='{{if ~populate_fields}}{{for attributes.valgrind_flags}}{{:}} {{/for}}{{else}}--leak-check=full --error-exitcode=1{{/if}}'>
    </div>
    <div class='form-group'>
        <label for='points_for_correct_return_code'>Points for correct return code: </label>
        <input type='text' name='points_for_correct_return_code'
                value='{{if ~populate_fields}}{{: attributes.points_for_correct_return_code}}{{else}}0{{/if}}' class='form-control'>
    </div>
    <div class='form-group'>
        <label for='points_for_correct_output'>Points for correct output: </label>
        <input type='text' name='points_for_correct_output'
                value='{{if ~populate_fields}}{{: attributes.points_for_correct_output}}{{else}}0{{/if}}' class='form-control'>
    </div>
    <div class='form-group'>
        <label for='points_for_no_valgrind_errors'>Points for Valgrind clean: </label>
        <input type='text' name='points_for_no_valgrind_errors'
                value='{{if ~populate_fields}}{{: attributes.points_for_no_valgrind_errors}}{{else}}0{{/if}}' class='form-control'>
    </div>
    <div class='form-group'>
        <label for='points_for_compilation_success'>Points for compilation success: </label>
        <input type='text' name='points_for_compilation_success'
                value='{{if ~populate_fields}}{{: attributes.points_for_compilation_success}}{{else}}0{{/if}}' class='form-control'>
    </div>
    {{if ~populate_fields}}<button type="submit" data-loading-text='Saving...' autocomplete='off' class="btn btn-default btn-success">Save Test</button>{{/if}}
</form>
